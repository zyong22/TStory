{{>/layout/post-header}}

<div class="container">
    <div class="d-flex justify-content-end my_mb_sm_1">

        <a href="/write-form" class="my_atag_none">
            <div class="my_icon_rounded_btn d-flex justify-content-center align-items-center"><i
                    class="fa-solid fa-pencil"></i></div>
        </a>
    </div>

    <div class="my_post_list" id="my-post-list">
        {{#postPage.content}}
            <div class="my_post_list_item">
                <div class="my_post_list_item_left">
                    <img src="/images/dog.jpg" width="100%" height="100%">
                    <!-- <div class="my_fakeimg"> </div> -->
                </div>
                <div class="my_post_list_item_right my_ellipsis">
                    <div class="my_text_title my_ellipsis">
                        <!-- 제목을 넣는 칸 -->
                        {{title}}
                    </div>
                    <div class="my_text_body_sm">
                        <!-- 내용을 넣는 칸 -->
                        {{{content}}}
                    </div>
                    <div class="my_mt_md_1">
                        <a href="/post/open/{{id}}" class="my_success_btn">상세보기</a>
                    </div>
                </div>
            </div>
        {{/postPage.content}}
    </div>

</div>

<script>

    let nextPage = 0;
    // 스크롤 이벤트 부분
    $(window).scroll(async () => {
        let scrollPercentage = ($(window).scrollTop() / ($(document).height() - $(window).height()));

        if (scrollPercentage >= 0.8) {
            nextPage++;
            let posts = await download(nextPage);

            posts.forEach(post=>{
                let card = cardRender(post);
                $("#my-post-list").append(card);
            });
        }
    });

    async function download(nextPage) {
        let response = await fetch("/list-form/ajax?page="+nextPage);
        let responseJson = await response.json();
        console.log(responseJson.content);
        return responseJson.content;
    }

    function cardRender(post) {
        return `<div class="my_post_list_item">
                <div class="my_post_list_item_left">
                    <img src="/images/dog.jpg" width="100%" height="100%">
                    <!-- <div class="my_fakeimg"> </div> -->
                </div>
                <div class="my_post_list_item_right my_ellipsis">
                    <div class="my_text_title my_ellipsis">
                        <!-- 제목을 넣는 칸 -->
                        ${post.title}
                    </div>
                    <div class="my_text_body_sm">
                        <!-- 내용을 넣는 칸 -->
                        ${post.content}
                    </div>
                    <div class="my_mt_md_1">
                        <a href="/post/open/${post.id}" class="my_success_btn">상세보기</a>
                    </div>
                </div>
            </div>`;
    }
</script>

{{>/layout/footer}}